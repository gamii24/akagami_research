# Microsoft Clarity ヒートマップ導入ガイド

## 📊 Microsoft Clarityとは？

Microsoft Clarityは**完全無料**の強力なヒートマップ・セッションリプレイツールです。

### 主な機能

1. **🔥 ヒートマップ**
   - クリックマップ：ユーザーがどこをクリックしているか
   - スクロールマップ：どこまでスクロールしているか
   - ムーブメントマップ：マウスの動きを可視化

2. **📹 セッションリプレイ**
   - ユーザーの実際の操作を動画で再生
   - エラーやフラストレーションを検出
   - モバイル・PC両方の操作を記録

3. **📈 インサイト**
   - ページのパフォーマンス分析
   - ユーザー行動の理解
   - 改善ポイントの発見

4. **✅ 特徴**
   - **完全無料**：トラフィック制限なし
   - **プライバシー保護**：個人情報を自動でマスキング
   - **簡単導入**：スクリプト1行で設置
   - **リアルタイム**：即座にデータを表示

---

## 🚀 セットアップ手順

### ステップ1: Clarityプロジェクト作成

1. **Microsoft Clarityにアクセス**
   - URL: https://clarity.microsoft.com/
   - Microsoftアカウントでログイン（無料）

2. **新しいプロジェクト作成**
   - 「New Project」ボタンをクリック
   - プロジェクト名：`Akagami.net`
   - ウェブサイトURL：`https://akagami.net`
   - 業界：`Education` または `Business`
   - 「Create」ボタンをクリック

3. **プロジェクトIDをコピー**
   - プロジェクト作成後、**Project ID**が表示されます
   - 例：`abc123xyz`（8-10文字のランダムな英数字）
   - このIDをメモしてください

### ステップ2: コードにProject IDを設定

1. **ファイルを開く**
   ```bash
   cd /home/user/webapp
   nano src/renderer.tsx
   ```

2. **Project IDを置換**
   - 167行目付近の `CLARITY_PROJECT_ID` を探す
   - あなたのProject IDに置き換える
   
   ```typescript
   // 変更前
   })(window, document, "clarity", "script", "CLARITY_PROJECT_ID");
   
   // 変更後（例）
   })(window, document, "clarity", "script", "abc123xyz");
   ```

3. **保存して閉じる**
   - Ctrl+X → Y → Enter

### ステップ3: デプロイ

```bash
# ビルド
cd /home/user/webapp
npm run build

# デプロイ
npx wrangler pages deploy dist --project-name akagami-net

# GitHubにプッシュ
git add -A
git commit -m "Add Microsoft Clarity heatmap integration"
git push origin main
```

### ステップ4: 動作確認

1. **サイトにアクセス**
   - https://akagami.net/ を開く
   - 数回クリックしてページを移動

2. **Clarityダッシュボード確認**
   - https://clarity.microsoft.com/ に戻る
   - プロジェクトをクリック
   - 「Recordings」タブで自分のセッションが記録されているか確認
   - **通常、最初のデータ表示まで5-15分かかります**

---

## 📊 使い方

### 1. ヒートマップの確認

1. Clarityダッシュボードにログイン
2. 左サイドバーの「Heatmaps」をクリック
3. 確認したいページURLを選択
4. ヒートマップの種類を選択：
   - **Click**: クリック箇所を色で表示（赤＝多い、青＝少ない）
   - **Scroll**: スクロール到達率を表示
   - **Area**: 注目されている領域を表示

### 2. セッションリプレイの確認

1. 左サイドバーの「Recordings」をクリック
2. 確認したいセッションをクリック
3. ビデオのように再生される：
   - クリック
   - スクロール
   - マウスの動き
   - ページ遷移
4. エラーやフラストレーションが自動で検出される

### 3. インサイトの活用

**改善できること:**
- ✅ クリックされていないボタンを発見 → UIを改善
- ✅ スクロールされていないコンテンツを発見 → レイアウト変更
- ✅ ユーザーがどこで離脱しているか → コンテンツ改善
- ✅ エラーが発生している箇所 → バグ修正

---

## 🔒 プライバシーとセキュリティ

### Clarityの自動マスキング

Microsoft Clarityは自動的に以下をマスキングします：
- ✅ メールアドレス
- ✅ パスワード入力欄
- ✅ クレジットカード番号
- ✅ 電話番号
- ✅ その他の個人情報

### 追加でマスキングする方法

特定の要素をマスキングしたい場合、HTMLにクラスを追加：

```html
<!-- この要素の内容はClarityで記録されません -->
<div class="clarity-mask">
  秘密のコンテンツ
</div>
```

---

## 📈 推奨設定

### フィルター設定

Clarityダッシュボードで便利なフィルターを設定：

1. **モバイル vs PC**
   - Device type: Mobile / Desktop
   - モバイルユーザーの動きだけを確認

2. **特定ページのみ**
   - Page URL: `/admin` を除外
   - 管理画面のデータを記録しない

3. **エラーセッションのみ**
   - Frustration signals: High
   - 問題のあるセッションだけを確認

### 週次レポート設定

1. 左サイドバーの「Settings」
2. 「Email reports」を有効化
3. 毎週月曜日にサマリーメールを受信

---

## 🎯 分析のベストプラクティス

### 1. 最初の1週間

- **目標**: ベースラインデータを収集
- **アクション**: 何もせず、データを観察

### 2. 問題発見フェーズ

- ヒートマップで改善ポイントを発見
- セッションリプレイで実際のユーザー行動を確認
- エラーやフラストレーションを特定

### 3. 改善実施

- UIを改善（ボタン位置、色、サイズ）
- コンテンツを改善（見出し、説明文、画像）
- エラーを修正

### 4. 効果測定

- 改善前後のデータを比較
- クリック率、スクロール率の変化を確認
- さらなる改善点を発見

---

## 🔧 トラブルシューティング

### データが表示されない

**原因1: Project IDが間違っている**
- `src/renderer.tsx`のProject IDを確認
- Clarityダッシュボードの「Settings」→「Project ID」と一致しているか確認

**原因2: スクリプトがブロックされている**
- ブラウザの開発者ツール（F12）→ Consoleタブでエラーを確認
- 広告ブロッカーを一時的に無効化

**原因3: 初回データ反映に時間がかかっている**
- 最初のデータ表示まで5-15分待つ
- 自分でサイトを何度か操作して、データを生成

### ヒートマップが表示されない

**原因: データ量が少ない**
- 最低30セッション以上必要
- 数日待ってからヒートマップを確認

---

## 📚 参考リンク

- **公式サイト**: https://clarity.microsoft.com/
- **ドキュメント**: https://docs.microsoft.com/ja-jp/clarity/
- **サポート**: https://clarity.microsoft.com/help

---

## ✨ Clarityで得られる改善例

### Before → After

**問題**: PDFカードのダウンロードボタンがクリックされていない
→ **改善**: カード全体をクリック可能に変更
→ **効果**: クリック率が2倍に増加

**問題**: スマホでページ下部までスクロールされない
→ **改善**: 「もっと見る」ボタンを追加
→ **効果**: 平均スクロール率が50%向上

**問題**: 検索ボタンが見つからない
→ **改善**: 検索ボックスを目立つ位置に配置
→ **効果**: 検索利用率が3倍に増加

---

## 🎉 完了！

これでMicrosoft Clarityの導入が完了しました！

数時間後にダッシュボードを確認して、ユーザーの行動を分析してください。

何か質問があれば、いつでもお気軽にお知らせください！
